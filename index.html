<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dolce Natale</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@400;600&display=swap');
    </style>
    <style>
        :root {
            --dark-green: #2d4f33;
            --gold: #d4af37;
            --paper: #f9f2ec;
            --ribbon-red: #d63447;
            --cover-color: #8b0000;
        }

        body {
            margin: 0;
            padding: 0;
            background: radial-gradient(circle at center, #1a3c24, #0a1f10);
            font-family: 'Poppins', sans-serif;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            color: var(--dark-green);
        }

        /* --- BOKEH --- */
        .bokeh {
            position: absolute;
            border-radius: 50%;
            filter: blur(40px);
            opacity: 0.4;
            z-index: 0;
            animation: bokehDrift linear infinite alternate;
            pointer-events: none;
        }
        .b1 { top: 10%; left: 20%; width: 200px; height: 200px; background: #ff5e5e; animation-duration: 15s; }
        .b2 { bottom: 20%; right: 10%; width: 250px; height: 250px; background: #ffd700; animation-duration: 20s; }
        .b3 { top: 40%; right: 30%; width: 150px; height: 150px; background: #4caf50; animation-duration: 18s; opacity: 0.3; }
        .b4 { bottom: 10%; left: 15%; width: 180px; height: 180px; background: #d63447; animation-duration: 22s; }

        @keyframes bokehDrift {
            0% { transform: translate(0, 0); }
            100% { transform: translate(30px, -30px); }
        }

        /* --- NEVE --- */
        .snowflake {
            position: absolute;
            top: -10px;
            color: #fff;
            opacity: 0.9;
            pointer-events: none;
            z-index: 1;
            animation: fall linear infinite;
            text-shadow: 0 0 5px rgba(255,255,255,0.8);
        }
        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }

        /* --- IL LIBRO 3D (DESKTOP) --- */
        #book-scene {
            width: 600px;
            height: 450px;
            perspective: 2000px;
            z-index: 10;
            position: relative;
            display: flex; /* Flex per desktop */
            justify-content: center;
            align-items: center;
        }

        .book {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 1s cubic-bezier(0.25, 1, 0.5, 1);
        }

        .book.closed { transform: translateX(-150px); }
        .book.open { transform: translateX(0); }

        /* PAGINA DESTRA (Fissa) */
        .static-right-page {
            position: absolute;
            top: 0; left: 300px;
            width: 300px; height: 100%;
            background: var(--paper);
            border-radius: 0 15px 15px 0;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.3);
            z-index: 1;
            padding: 20px; box-sizing: border-box;
            background-image: linear-gradient(to left, rgba(0,0,0,0.05), transparent 20%);
        }

        /* FLIPPER (Dorso che gira) */
        .spine-flipper {
            position: absolute;
            top: 0; left: 300px;
            width: 300px; height: 100%;
            transform-origin: left;
            transform-style: preserve-3d;
            transition: transform 1s cubic-bezier(0.25, 1, 0.5, 1);
            z-index: 10;
        }

        .book.open .spine-flipper { transform: rotateY(-180deg); }

        .flipper-face {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            backface-visibility: hidden;
            border-radius: 0 15px 15px 0;
            overflow: hidden;
        }

        /* FRONTE: COPERTINA */
        .front-cover {
            background: var(--cover-color);
            z-index: 2;
            color: var(--gold);
            border: 2px solid #5a0000;
            cursor: pointer;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background-image: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20 20 L40 40 M0 0 L20 20' stroke='%23600000' stroke-width='2' opacity='0.3'/%3E%3C/svg%3E");
        }

        /* RETRO: PAGINA SINISTRA */
        .back-page {
            background: var(--paper);
            transform: rotateY(180deg);
            padding: 20px; box-sizing: border-box;
            background-image: linear-gradient(to right, rgba(0,0,0,0.1), transparent 20%);
            display: flex; flex-direction: column;
            border-left: 1px solid #ddd;
            border-radius: 15px 0 0 15px;
        }

        /* STILI TESTO COMUNI */
        .paper-content { font-size: 0.75rem; line-height: 1.5; color: #333; overflow-y: auto; height: 100%; }
        .paper-content p { margin-bottom: 10px; text-align: justify; }
        .paper-content h2 { font-family: 'Great Vibes'; color: var(--cover-color); font-size: 1.8rem; margin: 0 0 10px 0; text-align: center; }
        .corner-decor { font-size: 1.5rem; text-align: center; margin: 5px 0; color: #556b2f; }
        .front-cover h1 { font-family: 'Great Vibes'; font-size: 3.5rem; margin: 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); line-height: 1.2; text-align: center; }

        .btn-reveal {
            margin-top: auto; align-self: center; padding: 8px 20px;
            background: var(--cover-color); color: var(--gold);
            border: none; border-radius: 20px; cursor: pointer;
            font-family: 'Poppins'; font-size: 0.8rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: transform 0.2s;
        }
        .btn-reveal:hover { transform: scale(1.1); }

        /* --- MOBILE ELEMENTS (Nascosti di default su desktop) --- */
        #mobile-cover-btn {
            display: none; /* Default hidden */
            flex-direction: column; align-items: center; justify-content: center; text-align: center;
            width: 85vw; height: 60vh;
            background: var(--cover-color);
            border: 6px solid var(--gold);
            border-radius: 15px; color: var(--gold);
            z-index: 50;
            box-shadow: 0 15px 40px rgba(0,0,0,0.6);
            cursor: pointer; transition: transform 0.2s;
        }
        #mobile-cover-btn:active { transform: scale(0.95); }

        #mobile-reader {
            display: none; /* Default hidden */
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: var(--paper);
            background-image: linear-gradient(to right, rgba(0,0,0,0.02), transparent 100%);
            z-index: 200;
            padding: 40px 25px; box-sizing: border-box;
            overflow-y: auto;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
        }
        #mobile-reader h2 { font-size: 2.5rem; margin-bottom: 20px; }

        /* --- MEDIA QUERY FONDAMENTALE --- */
        @media (max-width: 750px) {
            /* 1. Nascondiamo il libro 3D desktop */
            #book-scene { display: none !important; }
            
            /* 2. Mostriamo il bottone mobile (Flex per centrare il contenuto) */
            #mobile-cover-btn { display: flex !important; }
        }

        /* --- SCATOLE REGALO --- */
        #presents-container {
            display: none; gap: 45px; z-index: 10; flex-wrap: wrap; justify-content: center; width: 100%; perspective: 1000px;
        }
        .gift-box {
            width: 115px; height: 115px;
            background-color: #ff5e5e;
            background-image: radial-gradient(circle at center, rgba(255,255,255,0.3) 2px, transparent 2px);
            background-size: 15px 15px;
            border-radius: 24px; position: relative; cursor: pointer;
            box-shadow: inset 0 -5px 15px rgba(0,0,0,0.3), inset 0 5px 10px rgba(255,255,255,0.3), 0 20px 40px rgba(0,0,0,0.5), 0 5px 10px rgba(0,0,0,0.2);
            transition: transform 0.3s cubic-bezier(0.25, 1.5, 0.5, 1);
            animation: breathe 3s infinite ease-in-out;
            border-bottom: 4px solid #c92a2a;
        }
        .gift-box.gold-box {
            background-color: #ffd700;
            background-image: linear-gradient(45deg, rgba(255,255,255,0.2) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.2) 75%, transparent 75%, transparent);
            background-size: 20px 20px;
            border-bottom: 4px solid #b8860b;
             box-shadow: inset 0 -5px 15px rgba(0,0,0,0.4), inset 0 5px 10px rgba(255,255,255,0.5), 0 20px 40px rgba(0,0,0,0.5), 0 5px 10px rgba(0,0,0,0.2);
        }
        .gift-box::before { content: ''; position: absolute; width: 22px; height: 100%; background: linear-gradient(to right, #fff, #eee); left: 50%; transform: translateX(-50%); box-shadow: 0 0 5px rgba(0,0,0,0.2); border-radius: 4px; }
        .gift-box::after { content: ''; position: absolute; height: 22px; width: 100%; background: linear-gradient(to bottom, #fff, #eee); top: 50%; transform: translateY(-50%); box-shadow: 0 0 5px rgba(0,0,0,0.2); border-radius: 4px; }
        .bow {
            position: absolute; top: -30px; left: 50%;
            font-size: 3.8rem;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.3));
            z-index: 2;
            animation: bouncyBow 2s infinite ease-in-out;
        }
        @keyframes bouncyBow {
            0%, 100% { transform: translateX(-50%) translateY(0) rotate(0deg); }
            50% { transform: translateX(-50%) translateY(-6px) rotate(3deg); }
        }
        .gift-box:hover { transform: translateY(-15px) scale(1.05) rotateX(5deg); }

        /* --- PERSONAGGIO & REVEAL --- */
        #character-wrapper { position: fixed; bottom: 20px; z-index: 20; transition: left 0.5s linear, transform 0.3s; cursor: pointer; }
        #elf { width: 120px; height: 120px; background-image: url('lore_claus.png'); background-size: cover; background-position: center; border-radius: 50%; border: 4px solid #fff; box-shadow: 0 10px 25px rgba(0,0,0,0.5); display: block; }
        .speech-bubble { position: absolute; top: -50px; left: 50%; transform: translateX(-50%); background: white; color: #333; padding: 8px 12px; border-radius: 15px; font-size: 0.8rem; white-space: nowrap; box-shadow: 0 5px 15px rgba(0,0,0,0.2); opacity: 0; transition: opacity 0.3s, top 0.3s; pointer-events: none; }
        .speech-bubble::after { content: ''; position: absolute; bottom: -5px; left: 50%; transform: translateX(-50%); border-width: 5px; border-style: solid; border-color: white transparent transparent transparent; }
        .speech-bubble.show { opacity: 1; top: -70px; }
        
        #gift-reveal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(13, 38, 21, 0.95); backdrop-filter: blur(8px); z-index: 100; display: none; flex-direction: column; align-items: center; justify-content: center; animation: fadeIn 0.5s; }
        #gift-reveal img { max-width: 85%; max-height: 60vh; border: 8px solid white; border-radius: 25px; box-shadow: 0 0 50px rgba(255, 215, 0, 0.8); transform: scale(0.5); animation: popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        .close-btn { margin-top: 25px; padding: 12px 30px; background: var(--gold); color: #000; border: none; border-radius: 50px; font-family: 'Poppins', sans-serif; font-weight: 600; font-size: 1rem; cursor: pointer; box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4); transition: transform 0.2s; }
        .close-btn:hover { transform: scale(1.1); }

        /* --- ANIMAZIONI VARIE --- */
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.03) translateY(-2px); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes popIn { to { transform: scale(1); } }
        @keyframes waddle { 0% { transform: rotate(-5deg); } 50% { transform: rotate(5deg); } 100% { transform: rotate(-5deg); } }
        .waddling { animation: waddle 0.6s infinite ease-in-out; }
        .shake-box { animation: shake 2s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-3px, 0, 0) rotate(2deg); } 20%, 80% { transform: translate3d(5px, 0, 0) rotate(-2deg); } 30%, 50%, 70% { transform: translate3d(-5px, 0, 0) rotate(2deg); } 40%, 60% { transform: translate3d(5px, 0, 0) rotate(-2deg); } }
    </style>
</head>
<body>

    <div class="bokeh b1"></div>
    <div class="bokeh b2"></div>
    <div class="bokeh b3"></div>
    <div class="bokeh b4"></div>

    <div id="snow-container"></div>

    <div id="book-scene">
        <div class="book closed" id="theBook">
            
            <div class="static-right-page">
                <div class="paper-content">
                    <div class="corner-decor">ü´í</div>
                    
                    <div id="desktop-split-text-2">
                        <p>So anche che per te scendere in Calabria √® un po‚Äô dura, ma ti prometto che la situazione cambier√†. Non so quando, ma ci prover√≤ con tutto me stesso, soprattutto ora che sono qui stabilmente.</p>
                        <p>Una cosa che mi piacerebbe fare in questi giorni √® farci tante fotine, cos√¨ potremo stamparle e portarle nel cuore quando saremo di nuovo lontani.</p>
                        <p>Vedo un 2026 molto positivo per noi e per gli obiettivi che ci porremo. La strada per entrambi diventer√† sempre pi√π difficile, tra studio e ricerca, ma so che mi basta avviare una videochiamata e ascoltare la tua voce dolce per calmarmi e cambiarmi la giornata.</p>
                        <p style="text-align: center; font-weight: bold; color: #c92a2a; margin-top: 15px;">Ti amo tanto, amore mio.<br>Buon Natale, ninna ‚ù§Ô∏è</p>
                    </div>

                    <button class="btn-reveal" onclick="finishReading()">Scarta i Regali üéÅ</button>
                </div>
            </div>

            <div class="spine-flipper">
                
                <div class="flipper-face front-cover" onclick="openBook()">
                    <div style="font-size: 3rem;">üéÑ</div>
                    <h1>Buon Natale<br>Amore Mio</h1>
                    <div style="font-size: 2rem; margin-top: 20px;">üåª ü´í</div>
                    <p style="margin-top:auto; font-size: 0.8rem; opacity: 0.7;">(Clicca per aprire)</p>
                </div>

                <div class="flipper-face back-page">
                    <div class="paper-content">
                        <h2>Amore Mio,</h2>
                        <div class="corner-decor">üåª</div>
                        
                        <div id="desktop-split-text-1">
                            <p>Quest‚Äôanno √® stato un anno bellissimo per entrambi. Siamo riusciti a raggiungere obiettivi importanti e sono davvero felice sia per il nostro anno di convivenza sia per come sono andate le cose.</p>
                            <p>I pochi litigi che abbiamo avuto hanno dimostrato che, nonostante abbiamo due caratteri molto forti, durano sempre pochissimo. Nessuno dei due √® fatto per portare rancore: pian pianino cerchiamo subito di mandarci dei segnali, come a dire ‚ÄúDai, basta, √® durato abbastanza, ora voglio le coccole‚Äù.</p>
                            <p>Sono davvero orgoglioso di te, amore mio. So che non √® facile stare lontano da casa per cos√¨ tanto tempo, ma ce la stai facendo benissimo.</p>
                        </div>
                    </div>
                </div>

            </div> 
        </div>
    </div>

    <div id="mobile-cover-btn" onclick="openMobileReader()">
        <div style="font-size: 4rem; margin-bottom: 10px;">üéÑ</div>
        <h1 style="font-family:'Great Vibes'; font-size: 3.5rem; text-shadow: 2px 2px 0 #5a0000;">Buon Natale<br>Amore Mio</h1>
        <p style="margin-top: 20px; font-size: 1rem; opacity: 0.9;">(Tocca per aprire il libro)</p>
    </div>

    <div id="mobile-reader">
        <div style="position: absolute; top: 15px; right: 20px; font-size: 1.5rem; cursor: pointer; color: #888;" onclick="finishReadingMobile()">‚úï</div>
        
        <h2>Amore Mio,</h2>
        
        <div class="text-content" style="font-size: 1rem; line-height: 1.6;">
            <p>Quest‚Äôanno √® stato un anno bellissimo per entrambi. Siamo riusciti a raggiungere obiettivi importanti e sono davvero felice sia per il nostro anno di convivenza sia per come sono andate le cose.</p>
            <p>I pochi litigi che abbiamo avuto hanno dimostrato che, nonostante abbiamo due caratteri molto forti, durano sempre pochissimo. Nessuno dei due √® fatto per portare rancore: pian pianino cerchiamo subito di mandarci dei segnali, come a dire ‚ÄúDai, basta, √® durato abbastanza, ora voglio le coccole‚Äù.</p>
            <p>Sono davvero orgoglioso di te, amore mio. So che non √® facile stare lontano da casa per cos√¨ tanto tempo, ma ce la stai facendo benissimo.</p>
            
            <div style="text-align:center; font-size:1.5rem; margin:15px 0;">üåª ü´í</div>
            
            <p>So anche che per te scendere in Calabria √® un po‚Äô dura, ma ti prometto che la situazione cambier√†. Non so quando, ma ci prover√≤ con tutto me stesso, soprattutto ora che sono qui stabilmente.</p>
            <p>Una cosa che mi piacerebbe fare in questi giorni √® farci tante fotine, cos√¨ potremo stamparle e portarle nel cuore quando saremo di nuovo lontani.</p>
            <p>Vedo un 2026 molto positivo per noi e per gli obiettivi che ci porremo. La strada per entrambi diventer√† sempre pi√π difficile, tra studio e ricerca, ma so che mi basta avviare una videochiamata e ascoltare la tua voce dolce per calmarmi e cambiarmi la giornata.</p>
            
            <p style="text-align: center; font-weight: bold; color: #c92a2a; margin-top: 30px; font-size: 1.1rem;">Ti amo tanto, amore mio.<br>Buon Natale, ninna ‚ù§Ô∏è</p>
        </div>

        <button class="btn-reveal" onclick="finishReadingMobile()" style="display:block; margin: 30px auto; padding: 15px 30px; font-size: 1rem;">Apri i Regali üéÅ</button>
        <div style="height: 50px;"></div>
    </div>

    <div id="presents-container">
        <div class="gift-box" id="box1" onclick="tryOpenBox(1)"><div class="bow">üéÄ</div></div>
        <div class="gift-box gold-box" id="box2" onclick="tryOpenBox(2)"><div class="bow">üëë</div></div>
        <div class="gift-box gold-box" id="box3" onclick="tryOpenBox(3)"><div class="bow">üëë</div></div>
    </div>

    <div id="character-wrapper">
        <div class="speech-bubble" id="bubble">Ciao!</div>
        <div id="elf" class="waddling"></div>
    </div>

    <div id="gift-reveal">
        <h2 style="color: white; font-family: 'Great Vibes'; font-size: 3rem; margin: 0 0 20px 0; text-shadow: 0 0 10px gold;">Sorpresa!</h2>
        <img id="gift-image" src="" alt="Regalo">
        <button class="close-btn" onclick="closeGift()">Torna alla festa</button>
    </div>

    <script>
        /* --- CONFIGURAZIONE --- */
        const dateX = new Date(); dateX.setHours(0,0,0,0); 
        const dateY = new Date(2026, 1, 1);
        
        const book = document.getElementById('theBook');
        const bookScene = document.getElementById('book-scene');
        const presents = document.getElementById('presents-container');

        function createSnow() {
            const container = document.getElementById('snow-container');
            for(let i=0; i<60; i++) {
                let flake = document.createElement('div');
                flake.className = 'snowflake';
                flake.innerHTML = Math.random() > 0.5 ? '‚ùÑ' : '‚Ä¢';
                flake.style.left = Math.random() * 100 + 'vw';
                flake.style.fontSize = (Math.random() * 12 + 8) + 'px';
                flake.style.animationDuration = (Math.random() * 4 + 3) + 's';
                flake.style.animationDelay = Math.random() * 5 + 's';
                flake.style.opacity = Math.random() * 0.6 + 0.4;
                container.appendChild(flake);
            }
        }
        createSnow();

        // --- LOGICA PERSONAGGIO ---
        const charWrapper = document.getElementById('character-wrapper');
        const elf = document.getElementById('elf');
        const bubble = document.getElementById('bubble');

        elf.style.opacity = 0;
        elf.style.transition = "opacity 1s";

        // --- LOGICA LIBRO DESKTOP ---
        function openBook() {
            book.classList.remove('closed');
            book.classList.add('open');
            speak("Buona lettura amore!");
        }

        function finishReading() {
            bookScene.style.transition = "opacity 0.8s, transform 0.8s";
            bookScene.style.opacity = 0;
            bookScene.style.transform = "scale(0.8) translateY(-50px)";
            
            speak("Oh oh oh! Benvenuta amore mio!");

            setTimeout(() => {
                bookScene.style.display = 'none';
                showPresents();
            }, 800);
        }

        // --- LOGICA LIBRO MOBILE ---
        function openMobileReader() {
            document.getElementById('mobile-cover-btn').style.display = 'none';
            document.getElementById('mobile-reader').style.display = 'block';
            speak("Buona lettura amore!");
        }

        function finishReadingMobile() {
            const reader = document.getElementById('mobile-reader');
            reader.style.opacity = 0;
            reader.style.transform = "scale(0.9)";
            reader.style.transition = "all 0.5s";
            
            speak("Oh oh oh! Benvenuta amore mio!");
            
            setTimeout(() => {
                reader.style.display = 'none';
                document.getElementById('mobile-cover-btn').remove(); 
                showPresents();
            }, 500);
        }

        function showPresents() {
            presents.style.display = 'flex';
            elf.style.opacity = 1;

            const boxes = document.querySelectorAll('.gift-box');
            boxes.forEach((box, index) => {
                box.style.opacity = 0;
                box.style.transform = "translateY(100px)";
                setTimeout(() => {
                    box.style.transition = "all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275)";
                    box.style.opacity = 1;
                    box.style.transform = "translateY(0)";
                }, index * 200);
            });
        }

        // --- ANIMAZIONE ELFO ---
        let screenW = window.innerWidth;
        let pos = -150;
        let direction = 1;
        let walking = true;

        function animateCharacter() {
            if(!walking) return requestAnimationFrame(animateCharacter);
            pos += 1.2 * direction;
            charWrapper.style.left = pos + 'px';
            if (pos > screenW - 130) {
                direction = -1;
                elf.style.transform = "scaleX(-1)"; 
            } else if (pos < -20) {
                direction = 1;
                elf.style.transform = "scaleX(1)";
            }
            requestAnimationFrame(animateCharacter);
        }
        requestAnimationFrame(animateCharacter);
        window.addEventListener('resize', () => { screenW = window.innerWidth; });

        let bubbleTimer;
        function speak(text, time = 2000) {
            bubble.textContent = text;
            bubble.classList.add('show');
            clearTimeout(bubbleTimer);
            bubbleTimer = setTimeout(() => { bubble.classList.remove('show'); }, time);
        }

        charWrapper.addEventListener('click', () => {
            walking = false;
            elf.classList.remove('waddling');
            const phrases = [
                   "Sai perch√® gli USA non sanno giocare a scacchi? perch√® gli mancano due torri",
                    "Non ora, sto camminando!",
                    "Ciao amore mio!",
                    "Ti amo pi√π di ogni altra cosa!",
                    "Tutti i bambini avevano un nome tranne    ",
                    "Percy Jackson poi lo ritrovai",
                    "Che ne dici di un abbraccio?",
            ];
            speak(phrases[Math.floor(Math.random() * phrases.length)], 5000);
            elf.style.transform = direction === 1 ? "scale(1.1)" : "scaleX(-1) scale(1.1)";
            setTimeout(() => {
                elf.classList.add('waddling');
                elf.style.transform = direction === 1 ? "scaleX(1)" : "scaleX(-1)";
                walking = true;
                requestAnimationFrame(animateCharacter);
            }, 1500);
        });

        // --- APERTURA REGALI ---
        function tryOpenBox(id) {
            const today = new Date();
            let targetDate = (id === 3) ? dateY : dateX;
            const box = document.getElementById('box' + id);

            if (today >= targetDate) {
                walking = false;
                const phrases = [
                    "Evviva! Apriamolo!",
                    "Che sorpresa meravigliosa!",
                    "Non vedo l'ora di vedere cosa c'√® dentro!"
                ];
                speak(phrases[Math.floor(Math.random() * phrases.length)]);
                createParticles(box);
                const img = document.getElementById('gift-image');
                if(id===1) img.src = "reg1.png";
                if(id===2) img.src = "reg2.png";
                if(id===3) img.src = "reg3.png";
                setTimeout(() => { document.getElementById('gift-reveal').style.display = 'flex'; }, 800);
            } else {
                box.classList.add('shake-box');
                setTimeout(()=>box.classList.remove('shake-box'), 500);
                walking = false;
                const phrases = [
                   "You know how to drive the Ape car (a sa a lapa)",
                     "Non ancora! Torna pi√π tardi!",
                     "A birbante!"
                ];
                speak(phrases[Math.floor(Math.random() * phrases.length)]);
                setTimeout(() => { walking = true; requestAnimationFrame(animateCharacter); }, 1500);
            }
        }

        function closeGift() {
            document.getElementById('gift-reveal').style.display = 'none';
            walking = true;
            requestAnimationFrame(animateCharacter);
        }

        function createParticles(target) {
            const rect = target.getBoundingClientRect();
            const center = { x: rect.left + rect.width/2, y: rect.top + rect.height/2 };
            for(let i=0; i<45; i++) {
                const p = document.createElement('div');
                p.style.position = 'fixed';
                p.style.left = center.x + 'px';
                p.style.top = center.y + 'px';
                p.style.fontSize = Math.random() * 20 + 10 + 'px';
                const particles = ['‚≠ê', '‚ú®', 'üéÑ', 'üî¥', 'üü°'];
                p.innerHTML = particles[Math.floor(Math.random() * particles.length)];
                p.style.pointerEvents = 'none';
                p.style.zIndex = 1000;
                document.body.appendChild(p);
                const angle = Math.random() * Math.PI * 2;
                const velocity = Math.random() * 120 + 60;
                const tx = Math.cos(angle) * velocity;
                const ty = Math.sin(angle) * velocity;
                p.animate([
                    { transform: 'translate(0,0) scale(1) rotate(0deg)', opacity: 1 },
                    { transform: `translate(${tx}px, ${ty}px) scale(0) rotate(${Math.random()*360}deg)`, opacity: 0 }
                ], { duration: 1200, easing: 'cubic-bezier(0, .9, .57, 1)' }).onfinish = () => p.remove();
            }
        }
    </script>
</body>
</html>
